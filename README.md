# 🗳️ Decentralised-Voting-System
A full-stack demo dApp  
* **Next.js 14** + Tailwind  
* **Solidity Voting.sol** compiled / deployed with **Hardhat**  
* **MongoDB** for off-chain voter metadata  
* **Pinata / IPFS** to bulk-upload voters & candidates  
* **Nodemailer (Gmail)** mails credentials to each new voter  
> **Status:** Admin flow runs end-to-end; voter MetaMask verification is WIP.

## 1 · Prerequisites
| Tool | Version tested | Notes |
|------|----------------|-------|
| **Node** | 20.x | `nvm use 20` so Hardhat + Next agree |
| **npm**  | 10 (bundled) | |
| **Hardhat** | auto-installed | |
| **MongoDB** | 6.x (local or Atlas) | default URI `mongodb://127.0.0.1:27017/` |
| **MetaMask / Brave** | latest | RPC = `http://127.0.0.1:8545`

## 2 · Clone & install
```bash
git clone https://github.com/<your-org>/decentralised-voting-system.git
cd decentralised-voting-system
nvm install 20
nvm use 20
npm install
```

## 3 · Run local Hardhat chain & deploy
Open two terminals.  
**Tab A — hardhat-node**
```bash
npx hardhat node
```
**Tab B — deploy from project root**
```bash
npx hardhat compile
npx hardhat run scripts/deploy.js --network localhost
```
A successful deploy prints:
```
Voting deployed to: 0x...
```
and writes **frontend/artifacts/deployedAddress.json** automatically.

## 4 · MongoDB
```bash
# default local instance
mongod --dbpath ~/mongo-data
```
Adjust `lib/mongodb.js` if you prefer Atlas.

## 5 · (Optional) Gmail App-Password
Emails use an app-specific password – never your real Gmail login.  
Google Account → Security → 2-Step Verification → App passwords  
Select Mail · name it “Voting-App” → Generate  
Copy the 16-character code (no spaces)  
Add to `.env.local` (or keep the hard-coded demo creds in `pages/api/admin/processVoters.ts`):
```ini
EMAIL_USER=prproject201@gmail.com
EMAIL_PASS=xxxxxxxxxxxxxxxx
```

## 6 · Run Next.js dev-server
```bash
npm run dev
```
Visit:
- `http://localhost:3000` — landing  
- `http://localhost:3000/admin` — admin login

## 7 · Admin workflow (local demo)
**Login**
- email: `multiversesyndrome@gmail.com`
- pass: `SecurePass123`  
Upload `voters.json` and `candidates.json` (generated by helper script).  
Click **Upload & Process** → Pinata upload → Mongo insert/update → Gmail credentials → on-chain `registerVoter`.

## 8 · Voter workflow (✍ WIP)
- In MetaMask, import the voter account stored in Mongo (e.g., `0x7099...`)
- Go to `/signinusers`, change the temporary password
- Verify voter → cast vote (currently fails – see `TODO-metamask.md`)

## 9 · Troubleshooting
| Symptom / Error | Fix |
|------------------|------|
| `E11000 duplicate key …` | Drop `voters` collection or use fresh roll numbers |
| `535 BadCredentials` | Wrong Gmail app-password |
| `ENOENT Voting.json` | `npx hardhat compile` then redeploy |
| Front-end can’t hit chain | Make sure Hardhat node is still running, MetaMask RPC = `127.0.0.1:8545` |

## 10 · Helper scripts
```bash
# regenerate fake JSON for Pinata
python scripts/generate_fake_data.py      # voters.json & candidates.json

# pin any file quickly
node scripts/pinToPinata.js ./path/to/file
```
